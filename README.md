# Virtual Reconstruction of Spacial Reverberation
#### ECE 6413 - Digital Signal Processing
#### Mississippi State University
##### Repository: DSP_VirtualSpacialReconstruction

## Description of Project
The objective of this project is to create a system that artificially reconstructs the reverberative properties of an environment. Using the impulse response of the designated space, this system allows the user to simulate a space's acoustics for various inputs. The output of the artificial space is compared to the output of the real-world space. This ability is useful for sound engineers to test audio performance in different environments without the difficulty of a real-world experiment. Additionally, this system could reduce configuration time for public address (PA) systems by allowing the user to identify anomalies in the roomâ€™s frequency response. This application is beyond the scope of this project, but serves as an example of the potential applications this experiment.  A stretch goal for this project is to find the minimum filter size that is qualitatively indistinguishable from the full filter size in the simulated output. This is a practical consideration to address real-time scenarios. There are applications for this in virtual reality and live presentation scenarios.

## Literature Review
To prepare for this experiment, the authors conducted a review of published
literature. Six of these publications have been summarized and their
applications to this project examined in the following paragraphs.

One application of synthetic reverberation is virtual reality.
In this article, the author demonstrates the necessity for acoustic feedback in
video games to improve the user experience. The author explains the necessity
for accurate 3-D audio in virtual reality, and he designs an example game to
showcase the effects. Virtual reality has uses in many industries, and the
ability for programmers to recreate realistic audio is important to the
immersive experience.

An artificial reverberation effect can be generated by convolving the impulse
response of a space with a given signal input. In the
article, the author presents discrete-time linear, time-invariant filters using
feedback delay networks or single-input single-output state space.
Additionally, the algorithm presented accounts for various parameters
that effect the reverberation of a space. This article presents a description
of algorithms that can perform real-time artificial reverbation effects using
Matlab or VST.

A current field of research is the use of adaptive learning networks to
optimize the spacial presence of a sound in a room.
This is important for a variety of applications e.g. live audio performances or
studio recording. In, the author presents a system
used to test the relationship between certain reverberation properties.
Reverb is crucial to the improved subjective quality of a sound.

A key aspect to this experiment is determining the impulse response of a space.
A paper from the Audio Engineering Society discusses
using an area microphone and a balloon pop to measure the
impulse response of a room. It discusses the success of the measurement
compared to traditional methods of room impulse response (RIR) measurement.
This experiment did not use the results to recreate the reverberative response
of the room for an arbitrary input signal, but the results are helpful in
defining a method for measuing the impulse response in this experiment.

The presentation in gives examples
and real-world implementations of artificial reverb modeling techniques. These
techniques were all modeled using specifically designed reverb systems and
compared to the real reverberation effects of the room using qualitative
listening tests.

Many common equations used to describe reverberative effects and gives a list
of conditions that must be met in order to implement a useful artificial
reverberation system are defined in. These
conditions may be useful to this project in evaluating the output of the
test system.

## Description of Experiment
As previously stated, the objective of this project is to create a system,
using Matlab, which artificially reconstructs the reverberative properties of
an environment. Each environment has an infinite impulse response (IIR) that
defines the reverberation that occurs in the space. Since IIR filters cannot be
implemented in digital signal processors, the objective of this experiment is
to determine a FIR filter that approximates the impulse response of the IIR
filter. An FIR approximation of each space is obtained by inputting a impulse
in the space and recording the output using a microphone. Because of the
sampling rate and duration of sampling, this produces an FIR filter with a
length of at least 50,000. While a large filter may not be practical for
real-time implementation, there are applications in post-processing effects and
room analysis that do not require real-time speed. However, a stretch goal is
to minimze the filter size without an appreciative loss in quality, as
determined by the qualitative analysis, so that the filters may be used in
applications such as live performances or virtual reality simulations. The
experiment is conducted by measuring the room impulse response, inputting
an audio sample into the room while recording the output, and comparing to a
synthesized version of the output from Matlab.

To provide a variety of reverberation scenarios, the RIR is captured from the
following locations:

- Eric Farmer's Living room
- Simrall Hall Anechoic Chamber
- Simrall Hall Stairwell
- MSU SSRC Foyer
- MSU Old Intramural Fields.

The first step to measuring the RIR is to determine the noise floor of the room
and the microphone. This is accomplished by recording the output of the room
when there is no input. Using identical balloons filled to the same
circumference, the balloon pop simulates the impulse input into each space.
To prevent uneven spacial effects, the balloon and microphone are colocated in
the center of the space. An operator pops the balloon using a sharp needle
while standing at least one meter away while the microphone records the output
of the room. The operator is not colocated with the microphone and the balloon
to prevent distortions in the reverbation. The microphone records the impulse
response until the room returns to a threshold set by the root mean square (RMS)
of the noise floor. This process determines a large FIR filter for the space
and is repeated for each location.

After measuring the RIR and the space returning to its noise floor, each audio
input sample is played and the output of the room recorded on the microphone.
To prevent spacial distortions, the audio input sample is played through a
single speaker colocated with the microphone. Both the speaker and the
microphone are positioned such that the focus of the output/input is upward.
This process is repeated for each location.

After collecting the RIR for each space, Matlab is used to convolve each audio
input sample with each spacial impulse response. The results are stored for
later commparison.

The stretch goal is performed by using Matlab to reduce the size of the filter
and calculating the output for each audio input sample at each location. The
reduction is performed by removing every *n*th sample based on some reduction
factor. For example, if the reduction factor was 2, then every 2nd sample would
be removed. Thus, the filter size is scaled to L_{h} = (1 - RF^{-1})*L_{h}.

Once the steps above are complete, the data is ready to be analyzed using the code in this repository.

## Description of Data Analysis
The data in this experiment is analyzed both quantitatively and qualitatively.
The qualitative analysis is performed by five test subjects, which listen to
the simulated and real outputs for each space and rank the similarity in
reverberative qualities based on a scale from 1-10. The quantitative analysis
is performed using Matlab. The simulated and real outputs are aligned
and normalized, and the mean square error (MSE) between the two outputs is
calculated. A MSE is also calculated in the frequency domain between the two
samples by taking the fast Fourier transform (FFT) of both outputs. The MSE
results show the variation from the real-world and simulated outputs.

For the stretch goal, only qualitative analysis is performed. The objective is
to determine the smallest filter design that has no apparent differences to the
listener. Hopefully, the results of the qualitative analysis reveal the
smallest filter size.

This experiment contains possible sources of error. Neither the microphone nor
the speaker can have a perfectly-flat frequency response, which partially
distorts the measurements. The presence of a tester in the space to pop the
balloon also introduces slight variation to the RIR, even though the tester is
distant from the system. Other sources of possible error may be identified as
the experiment is conducted.
